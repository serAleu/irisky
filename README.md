[*]                    [*]                   [*]                    [*]                   [*]                    [*]
'####::::::::::::'########:::'####:::'######:::'##:::'##::'##:::'##::::'########::'########:::::'###:::::'##::::'##:
. ##::::::::::::::##.... ##::. ##:::'##... ##:::##::'##:::. ##:'##:::::... ##..::::##.....:::::'## ##:::::###::'###:
: ##::::::::::::::##:::: ##::: ##::::##:::..::::##:'##:::::. ####::::::::: ##::::::##:::::::::'##:. ##::::####'####:
: ##:::'#######:::########:::: ##:::. ######::::#####:::::::. ##:::::::::: ##::::::######::::'##:::. ##:::## ### ##:
: ##:::........:::##.. ##::::: ##::::..... ##:::##. ##::::::: ##:::::::::: ##::::::##...::::::#########:::##. #: ##:
: ##::::::::::::::##::. ##:::: ##:::'##::: ##:::##:. ##:::::: ##:::::::::: ##::::::##:::::::::##.... ##:::##:.:: ##:
'####:::::::::::::##:::. ##::'####::. ######::::##::. ##::::: ##:::::::::: ##::::::########:::##:::: ##:::##:::: ##:
....:::::::::::::..:::::..:::....::::......::::..::::..::::::..:::::::::::..::::::........:::..:::::..:::..:::::..::

1) Сапожников Сергей Алексеевич (Developer) - @ser_ser_ser / SAleSapozhnikov@sberbank.ru
2) Гагаев Александр Алексеевич (QA) - @gagaevich / aagagaev@sberbank.ru
3) Сираш Станислав Сергеевич (System Analyst) - @Stan_89 / sssirash@sberbank.ru
4) Костицына Кристина Ивановна (Developer) - @Kr_K_I / kikostitsyna@sberbank.ru

### For quick start just go here: [https//t.me/i-risky-bot]() - что бы вернуться на первый шаг процесса введите команду /start в чате бота


### Инструкция по запуску

[
   Note: начиная с 03.02.2025-00:00 по 05.02.2025-18:00 контейнер с сервисом i-risky-app будет запущен для обеспечения работоспособности i-risky-system.
   Публичные URLs по которым GigaAgentBuilder обращается к i-risky-app и URL по которому доступна H2Database будут заняты для демонстрации работы i-risky-system.
]

# Если у вас есть установленный docker:

выполнить: docker pull seraleu/i-risky-app:1.1.4
выполнить: docker run -p -d 127.0.0.1:3838:3838 seraleu/i-risky-app --rm

# Если у вас на рабочей машине установлена любая IDE и/или установлены Java, GIT и Maven:

запустить: cmd/Git Bush в той директории где вы хотите сбилдить i-risky-app.
выполнить: git init
выполнить: git clone https://github.com/serAleu/irisky.git
выполнить: cd irisky
выполнить: mvn clean install
выполнить: cd target
выполнить: java -jar i-risky-app.jar

Запущенный на локальной машине сервис работает на localhost

ссылка на h2 localhost: http://localhost:3838/h2-irisky/ 
ссылка на h2 в сети: https://irisky-giga.nl.tuna.am/h2-irisky/


###### Инструкция к использованию i-risky-app ######

# здесь и далее разработанное нами решение будет называться [i-risky-system]
# i-risky-system включает в себя несколько программных элементов работающих в единой логической системе
# i-risky-system разработана вне контура банка, поэтому, демонстрационные программные элементы доступны только в публичной сети


### i-risky-system включает в себя следующие программные элементы:

1) [Java Spring Service]
   [функциональность элемента]
     - эмуляция работы сервиса ППРБ в части предоставления кредитной истории клиента в формате JSON
     - эмуляция проверки валидности персональных данных в кредитной истории полученной в формате JSON от ППРБ
     - предоставление по HTTP в GigaAgentBuilder calculated variables, сохранение результатов работы агентов в БД
     - раскатка структуры и наполнение H2 Database + CRUD 
   [особенности реализации]
     - запускается на localhost в IDE или как Docker container
     - для взаимодействиями с ресурсами в сети использует url-port forwarding by https://tuna.am/
     - проверить что docker контейнер с сервисом запущен и i-risky-system готова к демонстрации - HTTP GET [https://irisky-giga.nl.tuna.am/health-check]

2) [GigaAgentBuilder]
   [функциональность элемента]
      - интеграция с Telegram и настройку UI в боте
      - оркестрация шагов пользователя в процессе прохождения клиентского пути (HTTP GET/POST -> Java Spring Service, логирование этапов прохождения пути, вызов работы AI агентов)
      - вызов генеративной модели GenAI GigaChat-Max для генерации ответов от нейросети
   [особенности реализации]
      - пишет информацию о каждом пройденном шаге процесса в чат пользователю в формате ###LOGGER:*текущий шаг процесса*### [ТОЛЬКО В РАМКАХ ДЕМО]
      - включает в себя 3 агента:
        1. credit-history-analyzer-agent - получает на вход JSON с кредитной историей клиента без персональных данных на основании этого JSON генерирует описание кредитной истории 
           клиента используя RAG + prompt
        2. credit-hist-analyze-validator-agent - получает на вход отчет, который сгенерировал credit-history-analyzer-agent, проверяет, что шаблон составлен корректно используя 
           RAG + prompt, если отчет составлен корректно, то этот агент отправляет отчет пользователю, если отчет составлен некорректно, то отправляет отчет на доработку обратно 
           в credit-history-analyzer-agent
        3. credit-hist-consultant - после получения клиентом проанализированной кредитной истории отвечает на вопросы клиента касательно данной кредитной истории и по запросу 
           пользователя дает советы по улучшению кредитной истории + так же предлагает услуги банка

3) [GenAI Gigachat Max]
   [функциональность элемента]
      - отвечает за результат работы всех AI агентов
      - осуществляет выполнение всех прописанных инструкций для конфигурационных элементов в GigaAgentBuilder
   [особенности реализации]
      - непосредственно вызываемая модель GigaChat-Max

4) [H2 Database] 
   [функциональность элемента]
      - хранение Mocks для эмуляции работы сервиса ППРБ - кредитные истории в формате JSON, PI, agreements
      - сохранение в БД этапов до/после вызова агентов
      - сохранение результатов работы агентов в отношении OneToMany / клиент к процессу анализа кредитной истории
   [особенности реализации]
      - аналог используемой в банке Pangolin (PostgreSQL)
      - переключение на использование PostgreSQL осуществляется сменой необходимого драйвера в настройках Java Spring Service
      - локальная база данных H2 раскатывается при поднятии Java Spring AI Service на localhost
      - что бы обратиться к БД поднятой в рамках демонстрации i-risky-system вам необходимо выполнить следующие действия:
        1. перейти по этой ссылке [https://irisky-giga.nl.tuna.am/h2-irisky/]
        2. в открывшемся интерфейсе нажать на [Connect]
        3. далее откроется Веб интерфейс H2 Database где вы можете выполнять SQL запросы и смотреть объекты БД аналогично как это организовано 
        в используемых в банке клиентах (dbeaver,pgAdmin и тп)
   
5) [RAG (Retrieval Augmented Generation)]
   [функциональность элемента]
      - обеспечение дополнительно необходимого контекста для работы агентов credit-hist-analyze-validator-agent и credit-hist-analyze-validator-agent
   [особенности реализации]
      - в данном .pdf файле описаны предназначение, смысл, возможные и пограничные значения необходимых JSON полей для составления описания кредитной истории и валидации составленного 
      описания кредитной истории клиента агентами.

6) [TelegramBot]
   [функциональность элемента]
      - адрес по которому можно использовать демонстрационный функционал бота: [https//t.me/i-risky-bot]()
      - основная задача бота - эмуляция работы СБОЛа
      - работает в качестве UI для взаимодействия пользователя с i-risky-system
   [особенности реализации]
      - бот создан, настроен и оформлен через стандартный функционал предоставляемый Telegram, а именно - @BotFather
      - слушает входящие сообщения, фиксирует нажатия кнопка и отвечает за генерацию ответа в чате бота программный элемент - GigaAgentBuilder

   
### Как использовать наше решение:

1) Зайти в Telegram
2) Найти чат бота: @i_risky_bot
3) Нажать на кнопку [Старт] или ввести команду [/start]
4) Бот выведет сообщение [Вы приобрели отчет о вашей кредитной истории от Объединенного Кредитного Бюро. Хотите получить анализ вашего отчета от нашего ИИ-помощника?]
и ниже 2 кнопки [Да, отправить отчет на анализ] и [Нет, спасибо], если отказаться, процесс завершит свою работу, если выбрать первый вариант, то перейдем на следующий шаг
5) После выбора отправки отчета на анализ, бот напишет сообщение [Пожалуйста, выберите чью кредитную историю вы хотите получить] и предоставляет button list, где каждая 
кнопка - это ФИО клиента, получение кредитной истории которого мы можем сэмулировать в рамках данного запуска. Каждый клиент имеет свое значение скорбалла и свои 
уникальные особенности в кредитной истории. Список возможных клиентов с кратким описанием их кредитной истории приложен в конце данной инструкции.
6) Необходимо выбрать клиента из предоставленного списка и нажать на кнопку с его ФИО. После этого начнется работы основной части процесса и начнут выводиться технические
сообщения в формате ###LOGGER:*текущий шаг процесса*### [ТОЛЬКО В РАМКАХ ДЕМО]. Когда с помощью искусственного интеллекта отчет будет сгенерирован, в чат поступит сообщение:
[Отчет по кредитной истории составлен!], а ниже появится кнопка [Получить отчет].
[
   Note: если в этот момент (до нажатия кнопки "Получить анализ отчета от ИИ-помощника") зайти посмотреть в логи сервиса или выполнить запрос в БД, мы увидим, что 
   произошла эмуляция проверки кредитной истории на предмет подтягивания некорректных данных в КИ клиента см. i_risky.credit_hist_processing_agent.pi_is_valid is true
]
7) Необходимо нажать на эту кнопку, далее в чат начнут поступать сообщения в формате [###LOGGER:*текущий шаг процесса*###] - это системный лог, который выводится 
пользователю только в рамках демо чтобы наблюдатель понимал какой шаг процесса сейчас выполняется. После прохождения всех шагов в чат будет отправлен проанализированный
и сгенерированный с помощью AI отчет по кредитной истории выбранного клиента в формате текстового описания.
8) Через 3 секунды после отправки отчета пользователь получит сообщение [Если у вас есть сомнения в точности вашей кредитной истории, предоставленной ОКБ (например, там 
упомянуты просрочки, которых в реальности не было), вы можете подать запрос на коррекцию кредитной истории через наш сервис оспаривания.], ниже будут 2 кнопки [Да, подать запрос]
и [Нет, спасибо], если выбрать первую кнопку, в чат будет отправлена ссылка на оспаривание хранящейся кредитной истории, после этого осуществляется переход на след шаг.
9) Далее будет выведен системный лог о начале работы агента консультанта, которому можно задавать вопросы по поводу полученной кредитной истории можно просить его дать советы 
и тп. Если попрощаться с ботом или сказать, что вопросов больше нет, процесс будет переведен на начальный этап (шаг 4 данной инструкции).


### Список тестовых клиентов
Новиков Михаил Андреевич - имеет очень хорошую кредитную историю и высокий кредитный рейтинг.
Никитина Дарья Антоновна - имеет несколько открытых кредитов с просрочками, и из-за этого - низкий кредитный рейтинг.
Лукаш Андрей Владимирович - человек с достаточно высоким кредитным рейтингом и хорошей кредитной историей
Иванько Михаил Витальевич - имеет хорошую кредитную историю: очень высокий рейтинг, имеет два открытых и два закрытых кредита.
Лазурная Виктория Ивановна - имеет средний рейтинг, на Виктории большое количество кредитов, из которых некоторые - с просрочками.
Грабко Антонина Владимировна - человек с достаточно высоким кредитным рейтингом, но в её кредитную историю закралась ошибка - некоторые записи повторяются несколько раз
Почеп Анастасия Олеговна  - человек с достаточно высоким кредитным рейтингом, но её кредитную историю закралась ошибка - один из кредитов ошибочно считается действующим
Снежный Константин Артемович - человек с плохой кредитной историей, допустивший несколько просрочек по кредитам
Киркоров Антон Магамедович - человек с достаточно высоким кредитным рейтингом, но его кредитную историю подпортили действия мошенников - они пытались оформить кредиты во множестве МФО